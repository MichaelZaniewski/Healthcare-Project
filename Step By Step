Everything Ive done:
Aggregated a LOS column

ALTER TABLE visits
ADD COLUMN los INT GENERATED ALWAYS AS (
    GREATEST((date_of_discharge::date - date_of_admission::date), 0)
) STORED;

easy join
FROM patient p JOIN billing b ON p.id = b.patient_id JOIN visit v ON b.visit_id = v.visit_id

Exploratory Analysis:
1) Frequency of LOS 
------------
SELECT los, COUNT(*)
FROM visit
GROUP BY los
ORDER BY los ASC
-------------
2) Frequency of conditions (and distinct conditions)

3) Frequency of followups
SELECT 
condition, count(follow_up_required) as Followups
FROM visit
WHERE follow_up_required = 'Y' 
GROUP BY condition
ORDER BY followups DESC 



For the hospital with the highest patient volume, find the percentage of patients discharged on the same day, after one night, and after multi nights. How do these percentages compare to the rest of the dataset? (CTE's)

WITH Lewis_Inc_Hospital AS (SELECT 'Lewis Inc Hospital' AS scope,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los = 0) / COUNT(*)::NUMERIC),2),'999D99%') AS sameday,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los = 1) / COUNT(*)::NUMERIC),2),'999D99%') AS one_night,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los > 1) / COUNT(*)::NUMERIC),2),'999D99%') AS multi_night
FROM visit
WHERE hospital = 'Lewis Inc Hospital'),

National AS (SELECT 'Nationally' AS scope,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los = 0) / COUNT(*)::NUMERIC),2),'999D99%') AS sameday,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los = 1) / COUNT(*)::NUMERIC),2),'999D99%') AS one_night,
TO_CHAR(ROUND(100*(COUNT(*) FILTER(WHERE los > 1) / COUNT(*)::NUMERIC),2),'999D99%') AS multi_night
FROM visit)

SELECT scope, sameday, one_night, multi_night
FROM Lewis_Inc_Hospital
UNION
SELECT scope, sameday, one_night, multi_night
FROM National
